<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Калькулятор стоимости 3D-печати</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f4f4f4;
        color: #333;
      }
      .container {
        max-width: 600px;
        margin: auto;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      h1,
      h2 {
        text-align: center;
      }
      label {
        display: block;
        margin: 10px 0 5px;
        font-weight: bold;
      }
      input,
      select,
      textarea,
      button {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        transition: all 0.2s ease;
      }
      button {
        cursor: pointer;
        transform-origin: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      button:active {
        transform: scale(0.95);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }
      .filter-buttons,
      .switch-group,
      .shape-buttons,
      .quality-buttons,
      .quantity-group {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 10px;
      }
      .filter-buttons button,
      .switch-group button,
      .shape-buttons button,
      .quality-buttons button {
        flex: 1;
        border: none;
        border-radius: 4px;
        background: #e0e0e0;
        color: #555;
        padding: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .filter-buttons button:active,
      .switch-group button:active,
      .shape-buttons button:active,
      .quality-buttons button:active {
        transform: scale(0.95);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }
      .filter-buttons button.active,
      .switch-group button.active,
      .shape-buttons button.active,
      .quality-buttons button.active,
      #toggleDetails.active {
        background: #4caf50;
        color: #fff;
      }
      .tab-content {
        margin-bottom: 10px;
      }
      .hidden {
        display: none;
      }
      .quantity-group > div {
        flex: 1;
      }
      .result,
      .total {
        padding: 10px;
        background: #e9e9e9;
        border-left: 5px solid #4caf50;
        border-radius: 4px;
        margin-top: 10px;
      }
      .result small,
      .total small {
        display: block;
        margin-top: 5px;
        color: #555;
      }
      #toggleDetails {
        background: #e0e0e0;
        color: #555;
        border: none;
        padding: 8px;
        width: 100%;
        margin-bottom: 10px;
        border-radius: 4px;
        cursor: pointer;
      }
      .details {
        padding: 10px;
        background: #fafafa;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      footer {
        text-align: center;
        margin-top: 20px;
        font-size: 14px;
      }
      footer a {
        color: #4caf50;
        text-decoration: none;
        margin: 0 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Калькулятор стоимости FDM 3D-печати</h1>
      <div class="filter-buttons" id="filterButtons">
        <button data-type="all" class="active">Все</button>
        <button data-type="хим">Химустойкие</button>
        <button data-type="уф">УФ-устойчивые</button>
        <button data-type="гиб">Гибкие</button>
        <button data-type="жест">Жесткие</button>
        <button data-type="бенз">Бензиноустойчивые</button>
        <button data-type="высокотемператур">Высокотемпературные</button>
      </div>

      <label for="material">Материал:</label>
      <select id="material"></select>
      <div id="materialInfo"></div>

      <div class="switch-group">
        <button id="massTabBtn" class="active">Масса</button>
        <button id="volumeTabBtn">Габариты</button>
      </div>

      <div id="massTab" class="tab-content">
        <label for="massValue">Масса (г):</label>
        <input
          type="number"
          id="massValue"
          min="0"
          oninput="this.value=this.value.replace(/-/g,'')"
        />
      </div>

      <div id="volumeTab" class="tab-content hidden">
        <div class="shape-buttons" id="shapeButtons">
          <button data-shape="box" class="active">Прямоугольник</button>
          <button data-shape="cylinder">Цилиндр</button>
          <button data-shape="cone">Конус</button>
          <button data-shape="sphere">Шар</button>
          <button data-shape="ring">Кольцо</button>
        </div>
        <div class="shape-inputs">
          <div data-shape="box">
            <label>Длина (мм):</label
            ><input type="number" id="length" min="0" />
          </div>
          <div data-shape="box">
            <label>Ширина (мм):</label
            ><input type="number" id="width" min="0" />
          </div>
          <div data-shape="box">
            <label>Высота (мм):</label
            ><input type="number" id="height" min="0" />
          </div>
          <div data-shape="cylinder" class="hidden">
            <label>Диаметр (мм):</label
            ><input type="number" id="diameter" min="0" />
          </div>
          <div data-shape="cylinder" class="hidden">
            <label>Высота (мм):</label
            ><input type="number" id="cylHeight" min="0" />
          </div>
          <div data-shape="cone" class="hidden">
            <label>Диаметр основания (мм):</label
            ><input type="number" id="coneDia" min="0" />
          </div>
          <div data-shape="cone" class="hidden">
            <label>Высота (мм):</label
            ><input type="number" id="coneHeight" min="0" />
          </div>
          <div data-shape="sphere" class="hidden">
            <label>Диаметр (мм):</label
            ><input type="number" id="sphereDia" min="0" />
          </div>
          <div data-shape="ring" class="hidden">
            <label>Внешний диаметр (мм):</label
            ><input type="number" id="outerDia" min="0" />
          </div>
          <div data-shape="ring" class="hidden">
            <label>Внутренний диаметр (мм):</label
            ><input type="number" id="innerDia" min="0" />
          </div>
          <div data-shape="ring" class="hidden">
            <label>Высота (мм):</label
            ><input type="number" id="ringHeight" min="0" />
          </div>
        </div>
      </div>

      <div class="quantity-group">
        <div>
          <label for="quantity">Количество шт</label>
          <input type="number" id="quantity" min="1" value="1" />
        </div>
        <div>
          <label for="fill">Заполнение (%)</label>
          <input type="number" id="fill" min="1" max="100" value="100" />
        </div>
      </div>

      <div class="quality-buttons" id="qualityButtons">
        <button data-quality="0.4">Черновое (0,4 мм)</button>
        <button data-quality="0.2" class="active">Стандарт (0,2 мм)</button>
        <button data-quality="0.1">Детализированное (0,1 мм)</button>
      </div>

      <div id="result" class="result"></div>
      <button id="toggleDetails">Подробности</button>
      <div id="details" class="details hidden">
        <p><strong>Пластик:</strong> <span id="userPlastic"></span></p>
        <p><strong>Масса пластика:</strong> <span id="userMass"></span></p>
        <p><strong>Габариты изделия:</strong> <span id="userVolume"></span></p>
        <p><strong>Количество:</strong> <span id="userQuantity"></span></p>
        <p><strong>Заполнение:</strong> <span id="userFill"></span></p>
        <p><strong>Высота слоя:</strong> <span id="userQuality"></span></p>
      </div>

      <h2>Отправить заявку</h2>
      <div class="request-form">
        <label for="userName">Имя и Фамилию</label
        ><input type="text" id="userName" />
        <label for="userPhone">Телефон</label
        ><input type="text" id="userPhone" placeholder="+7XXXXXXXXXX" />
        <label for="userEmail">Email</label
        ><input type="email" id="userEmail" />
        <label for="userMedia">Среда</label
        ><select id="userMedia">
          <option>Пищевка</option>
          <option>Химия</option>
          <option>Воздух</option>
        </select>
        <label for="userTemp">Рабочая температура</label
        ><select id="userTemp">
          <option>комнатная</option>
          <option>ниже 0°C</option>
          <option>выше 85°C</option>
        </select>
        <label for="detailName">Название детали</label
        ><input type="text" id="detailName" />
        <label for="workDesc">Описание работы</label
        ><textarea id="workDesc"></textarea>
        <label for="workFile">Приложить файл</label
        ><input type="file" id="workFile" />
        <label for="deadline">Сроки изготовления</label
        ><select id="deadline">
          <option value="3">Вчера x3</option>
          <option value="1">на этой неделе</option>
          <option value="0.95" selected>в течение месяца</option>
        </select>
        <div id="total" class="total"></div>
        <div id="statusMsg"></div>
        <button id="sendBtn">Отправить</button>
      </div>

      <footer>
        <a href="https://5dsap.ru" target="_blank">5dsap.ru</a> |
        <a href="https://3dzipper.ru" target="_blank">3dzipper.ru</a> |
        <a href="https://t.me/kunutok" target="_blank">Telegram</a>
        |
        <a href="https://wa.me/79607418138" target="_blank">WhatsApp</a>
      </footer>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const materials = {
          PLA: [
            1.24,
            2.42 * 5,
            "базовый, низкая химостойкость, неустойчив к УФ",
          ],
          PETG: [1.27, 1.35 * 5, "жесткий, прочный, умеренная химостойкость"],
          "PETG GF": [
            1.3,
            2.71 * 5,
            "инженерный, армирован стеклом, усто к УФ и химии",
          ],
          "PETG CF": [
            1.3,
            3.0 * 5,
            "инженерный, армирован углем, усто к УФ и химии",
          ],
          "TPU 60A": [1.2, 1.8 * 5, "гибкий, эластичный"],
          "TPU 75A": [1.2, 2.0 * 5, "гибкий средней жёсткости"],
          "TPU 95A": [1.2, 2.2 * 5, "жесткий, прочный"],
          "EASY FLEX": [1.18, 1.5 * 5, "упрощённая печать"],
          "SOFT FLEX": [1.18, 1.6 * 5, "особо мягкий"],
          "TPU HT": [1.2, 4.0 * 5, "высокотемпературный до 100°C"],
          "TPU CR": [1.2, 4.5 * 5, "химически стойкий"],
          PA6: [
            1.14,
            4.05 * 5,
            "инженерный, высокая химостойкость, устойчив к бензинам; неустойчив к УФ",
          ],
          PA12: [
            1.01,
            10.41 * 5,
            "нейлон, усто к спиртам, умеренная УФ-устойчивость",
          ],
          ABS: [
            1.05,
            1.79 * 5,
            "жесткий, устойчив к бензинам и лакокрасочным покрытиям; неустойчив к УФ",
          ],
          HIPS: [
            1.04,
            2.12 * 5,
            "жесткий, растворим в лимонене, низкая химостойкость",
          ],
          PC: [1.2, 4.25 * 5, "жаропрочный, высокая УФ-устойчивость"],
          PP: [
            0.9,
            5.38 * 5,
            "полипропилен, химически стойкий, устойчив к бензинам; неустойчив к УФ",
          ],
          PVA: [1.22, 5.39 * 5, "водорастворимый, вспомогательный"],
          PA1284: [1.13, 9.56 * 5, "инженерный, устойчив к УФ и химии"],
          SBS: [
            1.04,
            2.02 * 5,
            "ударопрочный, прозрачный; средняя химостойкость",
          ],
          ULTRAX: [
            1.4,
            8.03 * 5,
            "POM, высокая износостойкость, усто к УФ и химии",
          ],
          "PC GF": [1.3, 4.25 * 5, "армирован стеклом, усто к УФ"],
          "PP GF": [1.1, 4.46 * 5, "армирован стеклом, высокая химостойкость"],
          BIOCIDE: [1.27, 2.86 * 5, "антибактериальный, средняя химостойкость"],
        };
        const el = {
          filterButtons: document.getElementById("filterButtons"),
          material: document.getElementById("material"),
          materialInfo: document.getElementById("materialInfo"),
          massBtn: document.getElementById("massTabBtn"),
          volBtn: document.getElementById("volumeTabBtn"),
          massTab: document.getElementById("massTab"),
          volTab: document.getElementById("volumeTab"),
          shapeBtns: document.getElementById("shapeButtons"),
          shapeInputs: document.querySelectorAll(
            ".shape-inputs > [data-shape]"
          ),
          massVal: document.getElementById("massValue"),
          length: document.getElementById("length"),
          width: document.getElementById("width"),
          height: document.getElementById("height"),
          diam: document.getElementById("diameter"),
          cylH: document.getElementById("cylHeight"),
          coneD: document.getElementById("coneDia"),
          coneH: document.getElementById("coneHeight"),
          sphereD: document.getElementById("sphereDia"),
          oD: document.getElementById("outerDia"),
          iD: document.getElementById("innerDia"),
          rH: document.getElementById("ringHeight"),
          qty: document.getElementById("quantity"),
          fill: document.getElementById("fill"),
          qualBtns: document.getElementById("qualityButtons"),
          result: document.getElementById("result"),
          total: document.getElementById("total"),
          toggleDetails: document.getElementById("toggleDetails"),
          details: document.getElementById("details"),
          userPlastic: document.getElementById("userPlastic"),
          userMass: document.getElementById("userMass"),
          userVolume: document.getElementById("userVolume"),
          userQuantity: document.getElementById("userQuantity"),
          userFill: document.getElementById("userFill"),
          userQuality: document.getElementById("userQuality"),
          userName: document.getElementById("userName"),
          userPhone: document.getElementById("userPhone"),
          userEmail: document.getElementById("userEmail"),
          userMedia: document.getElementById("userMedia"),
          userTemp: document.getElementById("userTemp"),
          deadline: document.getElementById("deadline"),
          statusMsg: document.getElementById("statusMsg"),
          sendBtn: document.getElementById("sendBtn"),
          detailName: document.getElementById("detailName"),
          workDesc: document.getElementById("workDesc"),
        };
        function populateMaterials(type = "all") {
          el.material.innerHTML = "";
          Object.entries(materials).forEach(([name, [d, p, desc]]) => {
            if (type === "all" || desc.toLowerCase().includes(type)) {
              el.material.add(
                new Option(`${name} (${p.toFixed(2)} ₽/г) — ${desc}`, name)
              );
            }
          });
        }
        populateMaterials();
        el.filterButtons.addEventListener("click", (e) => {
          if (e.target.tagName === "BUTTON") {
            el.filterButtons
              .querySelectorAll("button")
              .forEach((b) => b.classList.remove("active"));
            e.target.classList.add("active");
            populateMaterials(e.target.dataset.type);
            calc();
          }
        });
        el.massBtn.addEventListener("click", () => {
          el.massBtn.classList.add("active");
          el.volBtn.classList.remove("active");
          el.massTab.classList.remove("hidden");
          el.volTab.classList.add("hidden");
          calc();
        });
        el.volBtn.addEventListener("click", () => {
          el.volBtn.classList.add("active");
          el.massBtn.classList.remove("active");
          el.volTab.classList.remove("hidden");
          el.massTab.classList.add("hidden");
          calc();
        });
        el.material.addEventListener("change", calc);
        el.shapeBtns.addEventListener("click", (e) => {
          if (e.target.tagName === "BUTTON") {
            el.shapeBtns
              .querySelectorAll("button")
              .forEach((b) => b.classList.remove("active"));
            e.target.classList.add("active");
            el.shapeInputs.forEach((div) =>
              div.classList.toggle(
                "hidden",
                div.dataset.shape !== e.target.dataset.shape
              )
            );
            calc();
          }
        });
        el.qualBtns.addEventListener("click", (e) => {
          if (e.target.tagName === "BUTTON") {
            el.qualBtns
              .querySelectorAll("button")
              .forEach((b) => b.classList.remove("active"));
            e.target.classList.add("active");
            calc();
          }
        });
        ["input", "change"].forEach((evt) => {
          [
            el.massVal,
            el.length,
            el.width,
            el.height,
            el.diam,
            el.cylH,
            el.coneD,
            el.coneH,
            el.sphereD,
            el.oD,
            el.iD,
            el.rH,
            el.qty,
            el.fill,
            el.deadline,
          ].forEach((inp) => inp && inp.addEventListener(evt, calc));
        });
        function calc() {
          const sel = el.material.value;
          if (!materials[sel]) {
            el.result.textContent = "Выберите материал.";
            return;
          }
          const [dens, price] = materials[sel];
          let mass = 0;
          if (el.massBtn.classList.contains("active"))
            mass = parseFloat(el.massVal.value) || 0;
          else {
            const shape =
              el.shapeBtns.querySelector("button.active").dataset.shape;
            switch (shape) {
              case "box":
                mass =
                  (((el.length.value || 0) *
                    (el.width.value || 0) *
                    (el.height.value || 0)) /
                    1000) *
                  dens;
                break;
              case "cylinder":
                mass =
                  ((Math.PI * (el.diam.value / 2) ** 2 * (el.cylH.value || 0)) /
                    1000) *
                  dens;
                break;
              case "cone":
                mass =
                  ((Math.PI *
                    (el.coneD.value / 2) ** 2 *
                    (el.coneH.value || 0)) /
                    3000) *
                  dens;
                break;
              case "sphere":
                mass =
                  (((4 / 3) * Math.PI * (el.sphereD.value / 2) ** 3) / 1000) *
                  dens;
                break;
              case "ring":
                mass =
                  ((Math.PI *
                    ((el.oD.value / 2) ** 2 - (el.iD.value / 2) ** 2) *
                    (el.rH.value || 0)) /
                    1000) *
                  dens;
                break;
            }
          }
          const fillFactor = Math.min(Math.max(el.fill.value, 1), 100) / 100;
          const qMap = { 0.4: 0.77, 0.2: 1, 0.1: 1.64 };
          const qf =
            qMap[el.qualBtns.querySelector("button.active").dataset.quality];
          const totalMass = mass * fillFactor;
          const qty = Math.max(parseInt(el.qty.value) || 1, 1);
          const cost = totalMass * price * qty * qf;
          el.result.innerHTML = `Ориентировочная стоимость: ${cost.toFixed(
            2
          )} ₽`;
          const factor = parseFloat(el.deadline.value) || 1;
          const final = cost * factor;
          el.total.classList.remove("hidden");
          el.total.innerHTML = `Итого: ${final.toFixed(2)} ₽`;
          if (el.userPlastic) el.userPlastic.textContent = sel;
          if (el.userMass)
            el.userMass.textContent = `${totalMass.toFixed(2)} г`;
          if (el.userVolume) {
            const volume = el.volTab.classList.contains("hidden")
              ? "-"
              : `${
                  ((el.length.value || 0) *
                    (el.width.value || 0) *
                    (el.height.value || 0)) /
                  1000
                }`;
            const dimensions = el.volTab.classList.contains("hidden")
              ? "-"
              : `${el.length.value || 0}х${el.width.value || 0}х${
                  el.height.value || 0
                } мм`;
            el.userVolume.innerHTML = `Размеры: ${dimensions}<br>Объем: ${volume} см³`;
          }
          if (el.userQuantity) el.userQuantity.textContent = qty;
          if (el.userFill)
            el.userFill.textContent = `${Math.min(
              Math.max(el.fill.value, 1),
              100
            )}%`;
          if (el.userQuality)
            el.userQuality.textContent =
              el.qualBtns.querySelector("button.active").textContent;
        }
        calc();
        el.toggleDetails.addEventListener("click", () => {
          el.toggleDetails.classList.toggle("active");
          el.details.classList.toggle("hidden");
        });
        el.sendBtn.addEventListener("click", (e) => {
          e.preventDefault();

          // Create FormData object
          const formData = new FormData();
          formData.append("name", el.userName.value);
          formData.append("phone", el.userPhone.value);
          formData.append("email", el.userEmail.value);
          formData.append("media", el.userMedia.value);
          formData.append("temp", el.userTemp.value);
          formData.append(
            "deadline",
            el.deadline.options[el.deadline.selectedIndex].text
          );
          formData.append("plastic", el.userPlastic.textContent);
          formData.append("mass", el.userMass.textContent);
          formData.append(
            "volume",
            el.volTab.classList.contains("hidden")
              ? "-"
              : `${
                  ((el.length.value || 0) *
                    (el.width.value || 0) *
                    (el.height.value || 0)) /
                  1000
                } см³`
          );
          formData.append(
            "dimensions",
            el.volTab.classList.contains("hidden")
              ? "-"
              : `${el.length.value || 0}х${el.width.value || 0}х${
                  el.height.value || 0
                } мм`
          );
          formData.append("quantity", el.userQuantity.textContent);
          formData.append("fill", el.userFill.textContent);
          formData.append("quality", el.userQuality.textContent);
          formData.append("total", el.total.textContent);
          formData.append("detailName", el.detailName.value);
          formData.append("workDesc", el.workDesc.value);

          // Add file if selected
          const fileInput = document.getElementById("workFile");
          if (fileInput.files.length > 0) {
            formData.append("workFile", fileInput.files[0]);
          }

          // Disable the button and show loading state
          el.sendBtn.disabled = true;
          el.statusMsg.textContent = "Отправка...";

          fetch(
            "https://bethichurig.beget.app/webhook-test/fd84ea85-fa6e-4b76-bbaa-8b8241d839c4",
            {
              method: "POST",
              body: formData,
            }
          )
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              return response.json();
            })
            .then((data) => {
              el.statusMsg.textContent = "Заявка успешно отправлена";
              el.statusMsg.style.color = "#4caf50";
              // Reset form
              el.userName.value = "";
              el.userPhone.value = "";
              el.userEmail.value = "";
              el.userMedia.value = "Пищевка";
              el.userTemp.value = "комнатная";
              el.deadline.value = "0.95";
              el.detailName.value = "";
              el.workDesc.value = "";
              fileInput.value = ""; // Reset file input
            })
            .catch((error) => {
              console.error("Error:", error);
              el.statusMsg.textContent = "Ошибка при отправке заявки";
              el.statusMsg.style.color = "#f44336";
            })
            .finally(() => {
              // Re-enable the button
              el.sendBtn.disabled = false;
            });
        });
      });
    </script>
  </body>
</html>
